# DoPlugs Malware Analysis

Interesting Analysis from [Trend Micro's Report](https://www.trendmicro.com/en_sg/research/24/b/earth-preta-campaign-targets-asia-doplugs.html).

## Description
This repository contains tools that were created after analyzing samples found from Trend Micro's Report as stated above.
Since there are some Control Flow Flattening (CFF) and Mixed Boolean Expressions here, it would be my first sample with CFF and thought it would be a good chance to learn as well.

> No, it does not have any IDA scripts to unflatten for us and things were analyzed dyanmically.

# Contents

## DOPLUGS_Quick_Check.ps1
This is the script that is used to test certain low hanging fruits on one of the DOPLUGS sample. 
It looks for:
1. Registry RUN Key
2. Scheduled Tasks Names
3. Scans files based off known filenames and hashes
4. Known C2 Addresses
5. Known malicious process names

## ScanProcessMemory.ps1
This script would attempt to dump processes based off known malicious process names. If there are, process memory would be dumped before scanning for known strings that are present in the malware.

## decrypt_Neroeaveedit_dat
This is a script to decrypt the Nerowaveedit.dat file

## decrypt_hidden_files
A wonky script that attempts to recover stolen files from hidden system folders `Kaspersky/Usb Drive/1.0/<CLSID from ms-pu Registry>/*`.

## Config Extractor
Contains `config_extractor.py` that would attempt to decrypt the config file from the malware (decrypted payload file). 
This is for samples with multiple bytes XOR key whose key can be found relative to `######` string within the malware.
## Tools folder
Tools Folder includes a SysInternalsSuite folder that holds two executables required for strings scanning of a malicious process name on a live system:
1. Strings64.exe
2. ProcDump64.exe

---
